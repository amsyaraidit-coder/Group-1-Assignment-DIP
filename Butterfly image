#butterfly

import numpy as np
import matplotlib.pyplot as plt
from PIL import Image

# 1. Define path
image_path = r"C:\Users\Asus\Downloads\butterfly.jpeg"

try:
    # 2. Load image
    img = Image.open(image_path)
    img_array = np.array(img)

    # 3. Get dimensions and channels
    rows, cols, channels = img_array.shape
    
    # Extract channels (convert to int to avoid overflow issues during subtraction)
    red = img_array[:, :, 0].astype(int)
    green = img_array[:, :, 1].astype(int)
    blue = img_array[:, :, 2].astype(int)

    # 4. Create the Mask (The Logic)
    # Condition A: Red must be the dominant color (Removes Green Background)
    is_red_dominant = (red > green) & (red > blue)
    
    # Condition B: Distinguish Orange (Butterfly) from Deep Red (Flower)
    # Orange has a significant amount of Green mixed in. Deep Red does not.
    # We require Green to be at least 40% of the Red intensity.
    is_orange_enough = green > (red * 0.4)

    # Condition C: Region of Interest (Optional but helpful)
    # The butterfly is in the top 70% of the image. The flower is at the bottom.
    # We create a coordinate grid to filter by location.
    # Create a grid of Y coordinates (row numbers)
    y_coords = np.arange(rows).reshape(rows, 1)
    # Broadcast this to match image width
    y_grid = np.repeat(y_coords, cols, axis=1)
    
    # Keep only pixels above row 850 (approximate bottom of butterfly)
    # You can remove this block if you want strictly color-based segmentation
    is_in_position = y_grid < (rows * 0.75)

    # Combine all conditions
    final_mask = is_red_dominant & is_orange_enough & is_in_position

    # 5. Apply Mask
    segmented_img = img_array.copy()
    
    # Invert mask to select what we want to REMOVE
    # logical_not turns True->False and False->True
    pixels_to_remove = np.logical_not(final_mask)
    
    # Set removed pixels to Black [0, 0, 0]
    segmented_img[pixels_to_remove] = [0, 0, 0]

    # 6. Display
    plt.figure(figsize=(10, 6))
    
    plt.subplot(1, 2, 1)
    plt.title("Original")
    plt.imshow(img_array)
    plt.axis('off')
    
    plt.subplot(1, 2, 2)
    plt.title("Butterfly Only (Color + Position)")
    plt.imshow(segmented_img)
    plt.axis('off')
